var qiao={};!function(e){function t(e){return function(t){if("."==t.charAt(0)){var r=e.split("/");r.splice(r.length-1,1),t=r.concat(t.split("/"));for(var a,o=0;a=t[o];o++)"."==a?(t.splice(o,1),o--):".."==a&&(t.splice(o-1,2),o-=2);t=t.join("/")}return!n[t]&&i[t]&&i[t].call(null),n[t]}}var n={},i={};e.config=function(){},e.define=function(e,r){var a=function(){var module={exports:{}},i=r(t(e),module.exports,module);i=i||module.exports,n[e]=i};i[e]=a},e.require=function(e,n){for(var i,require=t(""),r=[],a=0;i=e[a];a++)r.push(require(i));n.apply(null,r)}}(qiao),qiao.define("front/icon/fix",function(){function e(e){e.style.top="auto",e.style.bottom=0}var t={},n={},i={};return{init:function(e,r,a,o){t.users=e||[],t.groups=r||[],i=a,n=o},fixClose:function(){var r=t.groups;2==i.icontype&&(1==i.iconlevel&&r.length<=1&&e(n.close),2==i.iconlevel&&r.length<=1&&t.users.length<=1&&e(n.close))}}}),qiao.define("front/base/Promise",function(){function e(){this._callbacks=[]}return e.prototype.then=function(t,n){var i,r=this;return r._isdone?i=t.apply(n,r.result):(i=new e,r._callbacks.push(function(){var e=t.apply(n,arguments);e&&"function"==typeof e.then&&e.then(i.done,i)})),i},e.prototype.done=function(){var e=this;e.result=arguments,e._isdone=!0;for(var t=0,n=e._callbacks.length;n>t;t++)e._callbacks[t].apply(null,arguments);e._callbacks=[]},e.prototype.promise=function(){var e=this;return{then:function(){e.then.apply(e,arguments)}}},e}),qiao.define("front/data/group",function(require){"use strict";function e(e){for(var t,n=0,i=!1;t=e[n];n++)if(0!==t.islogin){i=!0;break}return i}function t(t){if(t||t.group){for(var n,i=0,t=t.group;n=t[i];i++)if(!(n.user.length<=0||-1==s.indexOf(o,n.groupid))){var r=e(n.user);c=r||c,u.push({groupid:n.groupid,groupname:n.groupname,online:r}),l.push(n)}d.done()}}function n(e){for(var t,n=0,i=u.length;i>n;n++)if(t=u[n],t.groupid==e)return t.groupname;return"分组"}function i(e){for(var t,n,i=0,r=0;t=l[r];r++){var a=t.user;for(i=0;n=a[i];i++)if(n.subid==e)return{groupid:t.groupid,groupname:t.groupname,subname:n.subname}}return null}var r=require("./config");require("../base/emitter");var a=require("../base/Promise"),o=r.getAllowGroup(),s=require("../base/array"),u=[],l=[],c=!1,d=new a;return{getGroupBySub:i,getGroupNameById:n,handleGroup:t,getGroup:function(){return u},hasLoginSub:function(){return c},getUser:function(){return l},asyncHandle:function(){return d.promise()},getOnlineSubId:function(){for(var e="",t=0;t<l.length;t++)if(l.online){e=l.subid;break}return e}}}),qiao.define("front/icon/view/min",function(require){function e(){var e=document.createElement("a");return e.setAttribute("href","javascript:;"),e.setAttribute("target","_self"),e.className=a,o=e,e}function t(){i.on(o,"click",function(e){e=e||window.event,e.preventDefault?e.preventDefault():e.returnValue=!1,r.emit("icon:open")})}var n=require("./const"),i=require("../../base/event"),r=require("../../base/emitter"),a=n("min"),o=null;return{render:function(n,i){var r=e();return n.appendChild(r),!i&&t(),r}}}),qiao.define("front/icon/view/close",function(require){function e(){var e=document.createElement("a");return e.setAttribute("href","javascript:;"),e.setAttribute("target","_self"),e.className=a,o=e,e}function t(){i.on(o,"click",function(e){e=e||window.event,e.preventDefault?e.preventDefault():e.returnValue=!1,r.emit("icon:close")})}var n=require("./const"),i=require("../../base/event"),r=require("../../base/emitter"),a=n("close"),o=null;return{render:function(n,i){var r=e();return n.appendChild(r),!i&&t(),r}}}),qiao.define("front/base/string",function(require){"use strict";var e=require("./lang"),t=new RegExp("(^[\\s\\t\\xa0\\u3000]+)|([\\u3000\\xa0\\s\\t]+$)","g");return{format:function(t,n){t=String(t);var i=[].slice.call(arguments,1);return i.length?(i=1==i.length?e.isArray(n)||e.isObject(n)?n:i:i,t.replace(/#\{(.+?)\}/g,function(t,n){var r=i[n];return e.isFunction(r)&&(r=r(n)),"undefined"==typeof r?"":r})):t},encodeHTML:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")},trim:function(e){return e.replace(t,"")}}}),qiao.define("front/icon/view/body",function(require){function e(e){for(var t,n=0,i=[];t=e[n];n++)t.online=t.online?b:"",i.push(l.format(C,t));return i.join("")}function t(e){var t,n,i,r=0,a=[];for(r;t=e[r];r++)for(t.online="",a.push(l.format(T,t)),n=0;i=t.user[n];n++)i.online=i.islogin?"qiao-icon-user-online":"",i.subname=l.trim(i.subname)||"&nbsp",a.push(l.format(S,i));return a.join("")}function n(n){var i=n.iconlevel,r=document.createElement("ins");r.className=p;var a=n.group,o=1==i?e(a):2==i?t(a):"";return r.innerHTML=o,E=r,r}function i(e){var t="BY_SELF";e.chattype=f.getChatType(t),d.emit("webim:open",e)}function r(){d.emit("mess:center")}function a(e){var t=e.className,n=e.id.replace(x,"");return t.indexOf(b)>-1?(i({groupid:n}),void 0):(r(n),void 0)}function o(e){var t=e.className,n=e.id.replace(w,"");return t.indexOf(y)>-1?(i({subid:n}),void 0):(r(n),void 0)}function s(){c.on(E,"click",function(e){e=e||window.event;var t=e.target||e.srcElement,n=t.className;return e.preventDefault?e.preventDefault():e.returnValue=!1,n.indexOf(m)>-1?(a(t),d.emit("stat","CLICK_ICON",{info:"bridgeIconClick"}),!1):n.indexOf(v)>-1?(o(t),d.emit("stat","CLICK_ICON",{info:"bridgeSubClick"}),!1):void 0})}var u=require("./const"),l=require("../../base/string"),c=require("../../base/event"),d=require("../../base/emitter"),f=require("../../common/identity"),p=u("body"),h=u("group"),m=u("group-link"),g=u("user-group"),v=u("user"),b=u("group-online"),y=u("user-online"),x=u("group"),w=u("user"),C='<ins class="'+h+'"><a '+'href="#" '+'target="_self" '+'id="'+x+'#{groupid}" '+'class="'+m+' #{online}">'+"#{groupname}"+"</a></ins>",T='<ins class="'+g+'">#{groupname}</ins>',S='<a href="#" target="_self" id="'+w+'#{subid}" '+'class="'+v+' #{online}">'+"#{subname}"+"</a>",E=null;return{render:function(e,t,i){var r=n(t);return e.appendChild(r),!i&&s(),r}}}),qiao.define("front/data/config",function(require){"use strict";function e(){for(var e,t=location.href,n=0,i=null;e=r[n];n++)(e.url==t||t.indexOf(e.url)>-1)&&(!i&&(i=e),i&&i.url&&i.url.length<e.url.length&&(i=e));return i?i.pageid:"0"}var t=require("../base/lang"),n="undefined"!=typeof BDBridgeConfig?BDBridgeConfig:{},i=n.BD_BRIDGE_DATA||{},r=n.BD_BRIDGE_SPECIAL||[],a={},o=function(){for(var t,i=n.BD_BRIDGE_STYLE_ITEM||[],a=r&&r.length<=0?"0":e(),o=0;t=i[o];o++)if(t.pageid==a)return t}();return{getSiteId:function(){return i.siteid||""},getSiteIdMd5:function(){return i.SITE_ID||""},getRoot:function(){return n.ROOT},getRcvRoot:function(){return n.RCV_ROOT},getMainId:function(){return i.mainid||""},getUserName:function(){return i.userName||""},getStyleConfig:function(module){return module?o["BD_BRIDGE_"+module.toUpperCase()]||{}:o},setStyleConfig:function(module,e){module&&(module="BD_BRIDGE_"+module.toUpperCase(),o[module]=t.extend(o[module],e))},getAllowGroup:function(){return o.BD_BRIDGE_GROUP||[]},getPageId:function(){return"0"==o.pageid?"":o.pageid},setModelData:function(e){a=t.extend(a,e)},getModelData:function(e){return e?a[e]:a},getStartTime:function(){return n.TIME_START}}}),qiao.define("front/common/identity",function(require){function e(){var e=a;return window[e]||(window[e]={})}var t=require("../data/config"),n=t.getSiteId(),i="QIAO_COOKIE_",r="QIAO_LS_"+n+"_",a="QIAO_NS_BSL",o="bridge",s={bid:n+"bid24",data:n+"data",show:n+"show",instance:n+"instance",chat:n+"chat",startload:n+"startload",ack:n+"ack",firstInfo:n+"firstInfo",prevInfo:n+"previousInfo",offsetTime:n+"offsetTime"},u={BY_INVITE:0,BY_SELF:1,AUTO_INVITE:3,ENFORCE:5};return{cookieId:function(e){return i+e.toUpperCase()},getLSKey:function(e){return r+e.toUpperCase()},getFlashId:function(){return o},getFlashKey:function(e){return s[e]||""},getBSLNs:function(){return e()},getChatType:function(e){return u[e]||u.BY_SELF}}}),qiao.define("front/base/event",function(require){"use strict";var e=require("./dom"),t=[];return{on:function(n,i,r,a){if(i=i.replace("/^on/i","").toLowerCase(),n=e.g(n)){var o=function(e){a=a||n,r.call(a,e)};return n.addEventListener?n.addEventListener(i,o,!1):n.attachEvent&&n.attachEvent("on"+i,o),t.push([n,i,r,o]),n}},un:function(n,i,r){i=i.replace("/^on/i","").toLowerCase(),n=e.g(n);for(var a,o=t.length;o--;)item=t[o],item[1]===i&&item[0]===n&&item[2]===r&&(a=item[3],n.removeEventListener?n.removeEventListener(i,a,!1):n.detachEvent&&n.detachEvent("on"+i,a),t.splice(o,1))}}}),qiao.define("front/icon/view/head",function(require){function e(e){var t=e.iconlevel,n=0==t?"a":"ins",i=document.createElement(n),r=s;if(0==t&&(i.setAttribute("href","javascript:;"),i.setAttribute("target","_self"),0==e.hasLoginSub)){var a=e.iconskin.useOfflineimg;a&&(r+=" qiao-icon-head-offline")}i.className=r;var c=document.createElement("ins");c.className=u;var d=document.createElement("ins");return d.className=l,d.innerHTML="在线咨询",i.appendChild(c),i.appendChild(d),o=i,{head:i,gradient:c,title:d}}function t(){i.on(o,"click",function(e){e=e||window.event,e.preventDefault?e.preventDefault():e.returnValue=!1;var t="BY_SELF";r.emit("webim:open",{chattype:a.getChatType(t)}),r.emit("stat","CLICK_ICON",{info:"bridgeClick"})})}var n=require("./const"),i=require("../../base/event"),r=require("../../base/emitter"),a=require("../../common/identity"),o=null,s=n("head"),u=n("gradient"),l=n("title");return{render:function(n,i,r){var a=e(i);return n.appendChild(o),!r&&0==i.iconlevel&&t(),a}}}),qiao.define("front/common/Fixed",function(require){"use strict";function e(){return Math.max(c.documentElement.scrollTop,c.body.scrollTop)}function t(){var e=c.documentElement,t=c.body,n=l?e:t;return n.clientHeight}function n(){return Math.max(c.documentElement.scrollLeft,c.body.scrollLeft)}function i(){var e=c.documentElement,t=c.body,n=l?e:t;return n.clientWidth}function r(e,t){return e.indexOf("%")>-1&&(e=parseInt(e,10)/100,e*=t),e=parseInt(e,10)}function a(e){var t=this;return u.instanceOf(t,a)?t.init(e):t=new a(e),t}var o=require("../base/browser"),s=require("../base/dom"),u=require("../base/lang"),l=o.isStrict(),c=document;return a.prototype={constructor:a,init:function(e){if(!(o.ie<=6||7==o.ie&&!o.isStrict())||!e)return null;var t=this;return t.el=s.g(e),t.el.style.position="absolute",t.set(),t},set:function(){var e=this;return e.isReady()?(e.getNodeRect(),e.analyze(),e.setHtml(),e.bindEvent(),void 0):(setTimeout(function(){e.set()},200),void 0)},analyzeTop:function(){var e,n=this,i=n.rect,a=t();if(!i.bottom||"auto"==i.bottom)return e=r(i.top,a),n.top=e,void 0;var o=r(i.bottom,a);e=a-o-n.el.offsetHeight,n.top=e},analyzeLeft:function(){var e,t=this,n=t.rect,a=i();if(!n.right||"auto"==n.right)return e=r(n.left,a),t.left=e,void 0;var o=r(n.right,a);e=a-o-t.el.offsetWidth,t.left=e},analyze:function(){var e=this;e.el,e.isReady()&&(e.analyzeTop(),e.analyzeLeft(),e.fix())},isReady:function(){var e=this.el;return e&&e.offsetHeight&&"visible"==s.getStyle(e,"visibility")?!0:!1},getNodeRect:function(){var e=this,t=e.el,n=t.style,i=t.currentStyle;e.rect={top:n.top||i.top,left:n.left||i.left,right:n.right||i.right,bottom:n.bottom||i.bottom}},setHtml:function(){var e=c.documentElement;e.style.backgroundImage="url(about:blank)",e.style.backgroundAttachment="fixed"},bindEvent:function(){var e=this;window.attachEvent("onscroll",function(){e.fix()}),window.attachEvent("onresize",function(){e.resizeFix()})},resizeFix:function(){var e=this;o.ie<=6&&(e.getNodeRect(),e.analyze())},fix:function(){var t=this,i=t.el;if(t.isReady()){var r=e(),a=n();i.style.top=r+t.top+"px",i.style.left=a+t.left+"px"}}},a}),qiao.define("front/common/Mask",function(require){"use strict";function e(){var e=document.createElement("iframe");return e.className=r,e.src="about:blank",e.setAttribute("frameborder",0),e.frameborder=0,e.border=0,e}function t(){this.init.apply(this,arguments)}var n=require("../base/browser"),i=require("../base/dom"),r=require("./view").getClassPre("mask")+"iframe";return t.prototype={constructor:t,init:function(t){var i=this;if(!n.ie||n.ie>6||!t)return null;var r=e(),a=t.firstElementChild||t.firstChild;return t.insertBefore(r,a),i.wrap=t,i.mask=r,i.auto(),i},auto:function(){var e=this,t=e.mask,n=e.wrap;return t&&n?n.offsetHeight&&"visible"==i.getStyle(n,"visibility")?(t.style.height=n.offsetHeight,t.style.width=n.offsetWidth,void 0):(setTimeout(function(){e.auto()},200),void 0):void 0}},t}),qiao.define("front/base/lang",function(){"use strict";function e(e){return"[object Array]"===n.call(e)}function t(e){return!(!e||!i.test(e))}var n={}.toString,i=/\{\s*\[(?:native code|function)\]\s*\}/i;return{isNative:t,isArray:t(Array.isArray)?Array.isArray:e,isObject:function(e){return e&&"[object Object]"===n.call(e)},isFunction:function(e){return e&&"[object Function]"===n.call(e)},instanceOf:function(e,t){return e&&e.hasOwnProperty&&e instanceof t},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}}}),qiao.define("front/base/array",function(require,exports){"use strict";var e=require("./lang");exports.indexOf=function(t,n){if(e.isNative([].indexOf))return t.indexOf(n);for(var i,r=0,a=t.length;a>r;r++)if(i=t[r],i===n)return r;return-1}}),qiao.define("front/base/emitter",function(require,exports){"use strict";var e=require("./array").indexOf,t={};exports.on=function(e,n){(t[e]=t[e]||[]).push(n)},exports.once=function(e,t){function n(){exports.off(e,n),t.apply(this,arguments)}exports.on(e,n)},exports.off=function(n,i){var r=arguments.length;if(0==r)return t={},void 0;if(1==r)return delete t[n],void 0;var a=t[n],o=e(a,i);o>-1&&a.splice(o,1)},exports.emit=function(e){var n=[].slice.call(arguments,1),i=t[e];if(i)for(var r=0,a=i.length;a>r;r++)i[r].apply(this,n)}}),qiao.define("front/common/view",function(){"use strict";function e(){if(r.wrap)return r.wrap;var e=document.createElement("ins");e.id=n+"wrap";var t=document.getElementsByTagName("script"),i=t[t.length-1];return"head"==i.parentNode.tagName&&(i=document.body.firstElementChild||document.body.firstChild),i.parentNode.insertBefore(e,i),r.wrap=e,e}function t(e){this.elements=e}var n="qiao-",i="qiao-",r={};return t.prototype.getElement=function(e){return this.elements[e]},{getWrap:function(){return e()},getIdPre:function(e){return n+e.toLowerCase()+"-"},getClassPre:function(e){return i+e.toLowerCase()+"-"},create:function(e){return new t(e)},setWrapTop:function(e){r.wrap&&e!=r.wrap.lastChild&&r.wrap.appendChild(e)}}}),qiao.define("front/icon/view/const",function(require){var e=require("../../common/view"),t=e.getIdPre("icon"),n=e.getClassPre("icon");return function(e,i){return("id"==i?t:n)+e.toLowerCase()}}),qiao.define("front/icon/view",function(require){function e(e){var t=u.g(g);return t||(t=document.createElement("ins"),t.id=g,t.className=v,t.style.visibility="hidden",e.appendChild(t)),t.innerHTML="",y=t,t}function t(){u.addClass(y,b),x&&x.auto(),w&&w.resizeFix()}function n(){u.removeClass(y,b),x&&x.auto(),w&&w.resizeFix()}function i(){s.on("icon:close",t),s.on("icon:open",n)}function r(){var e=y;return"visible"==u.getStyle(e,"visibility")&&e.offsetHeight?(e.style.marginTop=-Math.floor(e.offsetHeight/2)+"px",void 0):(setTimeout(function(){r()},200),void 0)}function a(e,t,n){var i=t.iconlevel,r=t.icontype,a=f.render(e,t,n);if(0!==i){var o=p.render(e,t,n);if(0!==r)var s=h.render(e),u=m.render(e)}var c=l.extend({},a);return o&&(c.body=o),u&&(c.min=u),s&&(c.close=s),c}var o=require("./view/const");require("../base/browser");var s=require("../base/emitter"),u=require("../base/dom"),l=require("../base/lang"),c=require("../common/Mask"),d=require("../common/Fixed"),f=require("./view/head"),p=require("./view/body"),h=require("./view/close"),m=require("./view/min"),g=o("wrap"),v=o("wrap"),b=o("wrap-min"),y=null,x=null,w=null;return{render:function(n,o,s){var u=e(n),l=a(u,o,s);l.container=u;var f=o.iconposition.postype;if(1===f&&0!==o.icontype){var p=o.iconposition.position;if(1===p||4===p){var p=o.position;r()}}return 0!==o.icontype&&(x=new c(u),w=new d(u)),1==o.iconmode&&t(),i(),require("../common/view").create(l)}}}),qiao.define("front/base/browser",function(){"use strict";var e,t=document,n=new RegExp("msie (\\d+\\.\\d+)","i");return{ie:function(){return n.test(navigator.userAgent)?t.documentMode||+RegExp.$1:e}(),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(navigator.userAgent)?+(RegExp.$6||RegExp.$2):void 0,isStrict:function(){return"CSS1Compat"==t.compatMode},isMobile:function(){var e=navigator.userAgent;return!!e.match(/.*Mobile.*/)||"ontouchstart"in window}()}}),qiao.define("front/base/dom",function(require){"use strict";function e(e){return e.replace(/-+(.)?/g,function(e,t){return t?t.toUpperCase():""})}function t(t,n,i){t.style[e(n)]=i}function n(e,n){for(var i in n)n.hasOwnProperty(i)&&t(e,i,n[i])}function i(e){var t=require("./browser").ie,n={};return 8>t?(n["for"]="htmlFor",n["class"]="className"):(n.htmlFor="for",n.className="class"),n[e]||e}function r(e,t){if(!e||!e.className)return!1;var n=new RegExp("(^| )"+t+"( |$)");return n.test(e.className)?!0:!1}function a(e){return e?"string"==typeof e||e instanceof String?document.getElementById(e):!e.nodeName||1!=e.nodeType&&9!=e.nodeType?null:e:null}var o=require("./browser");return{g:a,createIframe:function(e,t,n){var i=require("./browser").ie,r=9>i?'<iframe name="'+t+'">':"iframe",a=document.createElement(r);return a.setAttribute("id",e),a.setAttribute("name",t),a.style.display="none",a.setAttribute("src","about:blank"),n&&n.appendChild(a),a},create:function(e,t,r){var a=document.createElement(e);for(var o in t)t.hasOwnProperty(o)&&("styles"==o?n(a,t[o]):a.setAttribute(i(o),t[o]));return r&&r.appendChild(a),a},insertHTML:function(e,t,n){e=a(e);var i,r;return e.insertAdjacentHTML&&!o.opera?e.insertAdjacentHTML(t,n):(i=e.ownerDocument.createRange(),t=t.toUpperCase(),"AFTERBEGIN"==t||"BEFOREEND"==t?(i.selectNodeContents(e),i.collapse("AFTERBEGIN"==t)):(r="BEFOREBEGIN"==t,i[r?"setStartBefore":"setEndAfter"](e),i.collapse(r)),i.insertNode(i.createContextualFragment(n))),e},setStyle:t,setStyles:n,hasClass:r,getStyle:function(t,n){if(!t)return"";n=e(n);var i=9==t.nodeType?t:t.ownerDocument||t.document;if(i.defaultView&&i.defaultView.getComputedStyle){var r=i.defaultView.getComputedStyle(t,null);if(r)return r[n]||r.getPropertyValue(n)}else if(t&&t.currentStyle)return t.currentStyle[n];return""},addClass:function(e,t){return e&&!r(e,t)?(e.className+=" "+t,e):void 0},removeClass:function(e,t){if(e){var n=new RegExp("(\\s|^)"+t+"(\\s|$)");return e.className=e.className.replace(n,""),e}}}}),qiao.define("front/icon/main",function(require,exports){function e(){var e=r.getStyleConfig("icon"),u=0==e.icontype?t.g(o("fixed-wrap","id"))||t.g("BDBridgeFixedWrap"):i.getWrap();if(u){var l=a.getUser();l&&0!=l.length||(e.iconlevel=0);var c=a.getGroup(),d=2==e.iconlevel?l:c;e.group=d,e.hasLoginSub=a.hasLoginSub();var f=n.render(u,e);s.init(l,c,e,f.elements),s.fixClose()}}var t=require("../base/dom"),n=require("./view"),i=require("../common/view"),r=require("../data/config"),a=require("../data/group"),o=require("./view/const");require("../base/emitter");var s=require("./fix");exports.init=function(){var t=a.asyncHandle();t.then(e)}}),qiao.require(["front/icon/main"],function(e){e.init()}),qiao.define("front/invite/view/event",function(require){function e(){var e=[].slice.call(arguments);t.emit.apply(t,e)}var t=require("../../base/emitter"),n="invite:",i={close:function(){e(n+"close")},accept:function(){e(n+"accept")},reject:function(){e(n+"reject")},send:function(t){e(n+"send",t)}};return{emit:function(e){var t=[].slice.call(arguments,1),n=i[e];n&&n.apply(null,t)}}}),qiao.define("front/invite/view/operation",function(require){function e(){var e=u.getStyleConfig("invite");return"1"==e.type}function t(e){var t=require("../../base/dom"),n=require("./common");l.accept=t.create("ins",{className:n.className("accept")},e),l.accept.innerHTML=i,l.reject=t.create("a",{className:n.className("reject")},e),l.close=t.create("a",{className:n.className("close")},e),l.reject.innerHTML=r,l.form=t.create("ins",{className:n.className("form")},e),l.form.innerHTML='<ins class="'+n.className("form")+'-inner"></ins>';var s=l.form.firstChild;l.input=t.create("textarea",{className:n.className("input"),placeholder:o},s),l.send=t.create("a",{className:n.className("send")},s),l.send.innerHTML=a}function n(t){var n=require("../../base/event"),i=require("../../base/string"),r=require("./event"),a=function(){var e="";l.input&&(e=l.input.value=i.trim(l.input.value),l.input.value=""),r.emit("accept",e)};n.on(l.accept,"click",a),s.ie&&s.ie<=6&&e()&&n.on(t,"click",a),n.on(l.reject,"click",function(){r.emit("reject")}),n.on(l.close,"click",function(){r.emit("close")}),n.on(l.send,"click",function(){var e=l.input.value=i.trim(l.input.value);l.input.value="",r.emit("send",e)})}var i="现在咨询",r="稍后再说",a="发送",o="您可直接在这里和我们联系！",s=require("../../base/browser"),u=require("../../data/config"),l={};return{render:function(e,i){return t(e),i.bindEvent!==!1&&n(e),l}}}),qiao.define("front/invite/view/text",function(require){function e(n){if(n.offsetHeight){var i=-1*n.offsetHeight/2-20;t.setStyle(n,"margin-top",i+"px"),t.setStyles(n,{"margin-top":i+"px",visibility:"visible"})}else setTimeout(function(){e(n)},100)}var t=require("../../base/dom");return{render:function(n,i){var r=require("./common"),a=t.create("ins",{className:r.className("text"),styles:{visibility:"hidden"}});return a.innerHTML=i.text||"",n.appendChild(a),e(a),a}}}),qiao.define("front/invite/view/decoration",function(require){return{render:function(e){var t=require("./common").className("decoration"),n=require("../../base/dom").create("ins",{className:t},e);return n}}}),qiao.define("front/invite/view/common",function(require){"use strict";var e=require("../../common/view"),t="invite";return{id:function(n){return e.getIdPre(t)+n},className:function(n){return e.getClassPre(t)+n}}}),qiao.define("front/invite/view/container",function(require){"use strict";var e=require("./common"),t=require("../../base/dom"),n=require("../../base/browser"),i=require("../../common/Fixed"),r={WRAPPER:e.className("wrap"),IFRAME:e.className("wrap-mask")},a=e.id("wrap");return{render:function(e){var o=t.g(a);if(o)o.innerHTML="";else{if(o=t.create("ins",{id:a,className:r.WRAPPER,styles:{visibility:"hidden",display:"none"}}),n.ie&&n.ie<=6){var s=require("../../common/Mask");new s(o)}e.appendChild(o)}return i(o),o}}}),qiao.define("front/invite/view",function(require){"use strict";require("../base/dom");var e={},exports={},t=require("../common/view");return exports.hide=function(){e.container.style.display="none"},exports.show=function(){e.container.style.display="",t.setWrapTop(e.container)},{render:function(t,n){e.container=require("./view/container").render(t,n);var i=require("./view/decoration").render(e.container,n),r=require("./view/text").render(e.container,n),a=require("./view/operation").render(e.container,n),o=require("../common/view").create({container:e.container,decoration:i,text:r,operation:a});return require("../base/lang").extend(o,exports)}}}),qiao.define("front/base/cookie",function(){return{get:function(e){var t=new RegExp("(^| )"+e+"=([^;]*)(;|$)"),n=t.exec(document.cookie);return n?decodeURIComponent(n[2]):null},set:function(e,t,n){n=n||{};var i;n.expires&&(i=n.expires,"number"==typeof i&&(i=new Date,i.setTime(n.expires+i.getTime()))),document.cookie=e+"="+encodeURIComponent(t)+(n.path?"; path="+n.path:"")+(i?"; expires="+i.toGMTString():"")+(n.domain?"; domain="+n.domain:"")+(n.secure?"; secure":"")}}}),qiao.define("front/invite/main",function(require){function e(e,n,i){t(e),g[e]=setTimeout(n,i)}function t(e){var t=g[e];t&&clearTimeout(t)}function n(){var e="";return h.status==p.HAND?(e=h.subid,h.chatType=f.getChatType(v)):h.chatType=f.getChatType(b),e}function i(e){e=e||{},h=require("../base/lang").extend(h,e)}function r(n){var i=h.way>=1;h.way>=2,i&&h.interval&&e("autoInvite",a,1e3*h.interval),m.main.hide(),h.status==p.HAND&&n&&(c.emit("rcv:reject"),0===h.interval&&(h.way=1)),h.status=p.NONE,h.subid=null,h.count++,t("disapear")}function a(){if(!(0===h.interval&&h.count>=1)&&1==h.way%2&&h.status===p.NONE){if(0==h.page){var n=require("../base/cookie"),i=require("../common/identity").cookieId("INVITE_PAGE");if(n.get(i))return;n.set(i,1)}t("autoInvite"),h.status=p.AUTO,m.main.show(),h.disap&&e("disapear",function(){r()},1e3*h.disap)}}function o(n){var i=1===Math.floor(h.way/2);i&&(0===h.interval&&h.count>=1||h.status!=p.HAND&&(h.status==p.NONE&&m.main.show(),t("autoInvite"),h.status=p.HAND,h.subid=n,h.disap&&e("disapear",function(){r(!0)},1e3*h.disap)))}function s(){m.wrapper=require("../common/view").getWrap(),m.main=require("./view").render(m.wrapper,{text:h.text})}function u(e){if(1!=e.status)h.reported=!1;else if(o(e.subid),!h.reported){var t={subId:h.subid||0,open:1},n=d.getModelData("zhixin"),i=d.getModelData("servicetype");n&&(t.orderKey=n),i&&(t.servicetype=i),h.reported=!0,c.emit("stat","SEND_INVITE",t)}}function l(){for(var e in y)y.hasOwnProperty(e)&&c.on("invite:"+e,y[e]);c.on("rcv:refresh",u)}var c=require("../base/emitter"),d=require("../data/config");require("../data/group");var f=require("../common/identity"),p={NONE:0,AUTO:1,HAND:2},h={status:p.NONE,auto:0,interval:0,page:1,time:1,manual:0,repeat:0,disap:0,text:"",reported:!1,count:0,chatType:"BY_SELF",subid:null},m={},g={},v="BY_INVITE",b="AUTO_INVITE",y={};return y.close=function(){r(!0),c.emit("stat","CLOSE_INVITE",{})},y.accept=function(e){var t=n(),i={};""!==t&&(i.subid=t),i.chatType=h.chatType,i.chat=e||"",c.emit("webim:open",i),""!==t&&c.emit("stat","ACCEPT_INVITE",{subId:t,open:1}),r(),c.emit("stat","CLICK_ICON",{info:"invite"})},y.reject=function(){r(!0)},y.send=function(e){r();var t=n(),i={};""!==t&&(i.subid=t),i.chatType=h.chatType,i.chat=e||"",c.emit("webim:open",i),""!==t&&c.emit("stat","ACCEPT_INVITE",{subId:groupOption.subid,open:1}),c.emit("stat","CLICK_ICON",{info:"invite"})},{init:function(){var e=d.getStyleConfig("invite");i(e),s(),l(),1===h.way%2&&h.time&&setTimeout(function(){a()},1e3*h.time)}}}),qiao.require(["front/invite/main"],function(e){e.init()}),qiao.define("front/mess/view/foot",function(require){function e(e){n.send=i.create("a",{className:u,id:s},e),n.send.innerHTML=l.SEND,n.logo=i.create("ins",{className:c},e)}function t(){var e=require("../../base/event"),t=require("../../base/emitter");e.on(n.send,"click",function(){n.value="",t.emit("mess:send",n.value)})}var n={wrap:null,send:null,logo:null},i=require("../../base/dom"),r=require("./common"),a=r.id("foot"),o=r.className("foot"),s=r.id("foot-send-btn"),u=r.className("foot-send-btn"),l={},c=r.id("foot-logo");return{render:function(r,s){return l=s.LANGUAGE||{},n.wrap=i.create("ins",{id:a,className:o}),e(n.wrap),s.bindEvent!==!1&&t(),r.appendChild(n.wrap),n}}}),qiao.define("front/mess/view/head",function(require){function e(){var e=f.replace("#id",u).replace("#class",l),t=p.replace("#id",c).replace("#class",d);i.wrap.innerHTML=t+e}function t(t){i.wrap=a.create("ins",{id:o,className:s}),e(),t.appendChild(i.wrap)}function n(e){var t=require("../../base/event"),n=require("../../base/emitter");t.on(u,"click",function(e){n.emit("mess:toggle"),e=e||window.event,e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}),a.g(d),e.messSkin.active==h&&t.on(o,"click",function(){n.emit("mess:max")})}var i={close:null,text:null,wrap:null},r=require("./common"),a=require("../../base/dom"),o=r.id("head"),s=r.className("head"),u=r.id("head-close"),l=r.className("head-close"),c=r.id("head-text"),d=r.className("head-text"),f='<a id="#id" data-status="max" class="#class"></a>',p='<ins id="#id" class="#class" ></ins>',h="0";return{render:function(e,r){return t(e),r.bindEvent!==!1&&n(r),i}}}),qiao.define("front/mess/view/placeholder",function(){"use strict";function e(e){if(!("placeholder"in document.createElement("input")))for(var r,a=e.getElementsByTagName("*"),o=0;o<a.length;o++){var s=a[o].tagName.toLowerCase();("input"==s||"textarea"==s||"select"==s)&&(r=a[o],r.onfocus=n,r.onblur=i,r.onchange=t,r.onblur())}}function t(){var e=this.getAttribute("placeholder"),t=this.value;t===e&&(this.style.color=a)}function n(){var e=this.getAttribute("placeholder"),t=this.value;t===e&&(this.value="",this.style.color=a)}function i(){var e=this.getAttribute("placeholder"),t=this.value;""===t&&(this.value=e,this.style.color=r)}var r="#999",a="#000";return{fixPlaceholder:e}}),qiao.define("front/mess/view/validate",function(){function e(e,t){var n=!0,i={};if("[object Array]"=={}.toString.call(t))for(var i,a=0;(i=t[a])&&(n=r[i.type](e,i),n);a++);return{result:n,msg:i&&i.msg}}function t(e){var t=e.getAttribute("placeholder"),n=e.value;return n===t&&(n="",e.value=""),n}function n(n,i){for(var r=n.getElementsByTagName("*"),a=[],o=0,s=r.length;s>o;o++){var u=r[o],l=u.getAttribute("name"),c=i[l]||!1;if(l&&c){var d=t(u),f=e(d,c);f.result||a.push({name:l,msg:f.msg})}}return a}function i(e){for(var t=o.ERR_TITLE+"\n",n=[],i=0,r=e.length;r>i;i++){var a=e[i];n.push(a.msg+"\n")}return t+=n.join("")}var r={},a={email:/^[_\w-]+(\.[_\w-]+)*@([\w-])+(\.[\w-]+)*((\.[\w]{2,})|(\.[\w]{2,}\.[\w]{2,}))$/,url:/^[^.。，]+(\.[^.，。]+)+$/,mobilePhone:/^1\d{10}$/,number:/^\d*$/},o={};return r.len=function(e,t){var n=!0;return e=e.toString(),void 0!==t.min&&(n=n&&e.length>=t.min),void 0!==t.max&&(n=n&&e.length<=t.max),n},r.range=function(e,t){var n=!0;return e=+e,void 0!==t.min&&(n=n&&e>=t.min),void 0!==t.max&&(n=n&&e<=t.max),n},r.regexp=function(e,t){if(""==e)return!0;var n=a[t.rule]||new RegExp(t.rule);return e=e.toString(),n.test(e)},{check:function(e,t,r){var a=n(e,t);o=r||{};var s=!a.length,u=i(a);return{result:s,msg:u}}}}),qiao.define("front/mess/view/body",function(require){function e(e){var e=e||"",t=L.replace("#name",e).replace(/#itemHolder/g,m.TIP_MESS),n=C(m.TEXT,0)+": ";return y.rules[e]=[{type:"len",min:1,msg:n+m.ERR_NOT_NULL}],t}function t(e,t,n,i){var r=y.rules;r[e]=[];var a="display:none",o=t+": ";return("1"==i||i===!0)&&(a="display:inline",r[e].push({type:"len",min:1,msg:o+m.ERR_NOT_NULL})),r[e].push({type:"len",max:100,msg:o+m.ERR_NOT_NULL}),"bd_bp_messPhone"==e&&r[e].push({type:"regexp",rule:"number",msg:o+m.ERR_NUMBER_ONLY}),"bd_bp_messEmail"==e&&r[e].push({type:"regexp",rule:"email",msg:o+m.ERR_EMAIL_STYLE}),e=e||"",n=n||m.TIP_DEFAULT,t=t||"",html=D.replace("#itemTitle",t).replace("#name",e).replace("#star",a).replace(/#itemHolder/g,n)}function n(e,t,n,i){e=e||"",n=n||m.TIP_DEFAULT,t=t||"",i=i||[];for(var r="",a=0,o=i.length;o>a;a++){var s=p(i[a]);r+='<option value="'+s+'">'+s+"</option>"}return html=P.replace("#itemTitle",t).replace("#name",e).replace(/#itemHolder/g,n).replace("#options",r)}function i(e){var t=e.name||"",n=e.value||"",i=R.replace("#value",n).replace("#name",t);return i}function r(e){var t=T.g(E);t?(b.wrap=t,b.wrap.innerHTML=""):(b.wrap=T.create("ins",{id:E,className:I}),e.appendChild(b.wrap)),b.form=T.create("form",{className:j+" clearfix",method:"post",target:N,action:v.SUBMIT+y.siteId+"&page_id="+y.pageId}),b.form.setAttribute("accept-charset","utf-8"),b.iframe=T.createIframe(N,N,b.wrap),o(b.form),b.wrap.appendChild(b.form)}function a(){var e={name:"bd_bp_title",value:document.title},t={name:"bd_bp_referer",value:document.referrer},n={name:"bd_bp_tick",value:(new Date).getTime()},r=i(e)+i(t)+i(n);return r}function o(n){var i=y.options.messItem,r=y.options.extraMessItems,o="";o+=e("bd_bp_messText"),"2"!=i.messItemName&&(o+=t("bd_bp_messName",C(m.NAME,0),m.TIP_DEFAULT,i.messItemName)),"2"!=i.messItemPhone&&(o+=t("bd_bp_messPhone",C(m.PHONE,0),C(m.PHONE,1),i.messItemPhone)),"2"!=i.messItemAddress&&(o+=t("bd_bp_messAddress",C(m.ADDRESS,0),m.TIP_DEFAULT,i.messItemAddress)),"2"!=i.messItemEmail&&(o+=t("bd_bp_messEmail",C(m.EMAIL,0),C(m.EMAIL,1),i.messItemEmail)),r&&r.length>0&&(o+=s(r)),o+=a(),n.innerHTML=o,S.fixPlaceholder(b.form)}function s(e){for(var i=null,r="",a="bd_bp_extral_",o="",s=0,u=e.length;u>s;s++){i=e[s],o=p(i.key);
var l="1"==i.necessity?!0:!1;r+=i.subItems?n(a+s,o,"",i.subItems,l):t(a+s,o,"",l)}return r}function u(){b.form.reset()}function l(){require("../../base/event"),require("../../base/string")}function c(){f.on("mess:send",O.send)}function d(e){return"0"==e?h.CHINESE:h.ENGLISH}var f=require("../../base/emitter"),p=require("../../base/string").encodeHTML,h=require("./language"),m={},g=require("../../data/config").getRoot(),v={SUBMIT:g+"?module=default&controller=index&action=doMess&siteid="},b={form:"",phone:"",email:"",message:"",send:"",custom:{}},y={options:{},siteId:"",pageId:"",rules:{}},x=require("./validate"),w=require("./common"),C=w.getLanText,T=require("../../base/dom");require("../../base/lang");var S=require("./placeholder"),E=w.id("body"),I=w.className("body"),N=w.id("iframe"),j=w.className("form"),M=w.className("item"),k=w.className("item-head"),_=w.className("item-body"),A=w.className("item-mess"),B=/msie (\d+\.\d+)/i.test(navigator.userAgent),O={},D='<ins class="'+M+' clearfix">'+'<ins class="'+k+'">#itemTitle'+'<ins class="qiao-mess-star" style="#star">*</ins>'+"</ins>"+'<ins class="qiao-mess-input-wrap">'+'<input name="#name" class="'+_+'"  placeholder="#itemHolder">'+"</ins>"+"</ins>",P='<ins class="'+M+' clearfix">'+'<ins class="'+k+'">#itemTitle</ins>'+'<ins class="qiao-mess-input-wrap">'+'<select name="#name" class="'+_+'"  placeholder="#itemHolder">'+"#options"+"</select>"+"</ins>"+"</ins>",L='<ins class="clearfix"><ins class="clearfix '+A+'">'+'<ins style="display:none">留言内容</ins>'+'<textarea name="#name" class=""  placeholder="#itemHolder"></textarea>'+'<ins class="qiao-mess-star">*</ins>'+"</ins>"+"</ins>",R='<input type="hidden" style="display:none" value="#value" name="#name" />';return O.send=function(){var e=x.check(b.form,y.rules,m);if(e.result){var t=!1;B&&(t=document.charset,document.charset="utf-8"),b.form.submit(),B&&(document.charset=t),f.emit("mess:min"),setTimeout(function(){u(),S.fixPlaceholder(b.form)},0),f.emit("stat","SEND_MESS",{open:1})}else S.fixPlaceholder(b.form),alert(e.msg)},{render:function(e,t){return t.rules&&(y.rules=t.rules||{}),m=t.LANGUAGE||d(t.messItem.language),y.options=t||{},y.siteId=t.siteId||"",y.pageId=t.pageId||"",b.main=e,r(e,t),t.bindEvent!==!1&&(l(),c()),b}}}),qiao.define("front/mess/view/container",function(require){var e=require("./common"),t=require("../../base/dom"),n=e.id("container"),i=e.className("container");return{render:function(e){var r=t.g(n);return r=t.create("ins",{id:n,className:i}),e.appendChild(r),r}}}),qiao.define("front/mess/view/common",function(require){"use strict";function e(e,t){var n=e.split("%bd_bp_sp%");return n[t]}var t=require("../../common/view"),n="mess";return{id:function(e){return t.getIdPre(n)+e},className:function(e){return t.getClassPre(n)+e},getLanText:e}}),qiao.define("front/mess/view/language",function(){var e={TITLE:"欢迎给我们留言",TEXT:"留言内容",SEND:"发送",RIGHT_TIP:"百度提供技术支持",NAME:"姓名",PHONE:"电话%bd_bp_sp%请输入您的电话号码",ADDRESS:"地址",EMAIL:"邮箱%bd_bp_sp%请输入合法邮箱名",SELECT:"请选择",TIP_DEFAULT:"最多100个字符",TIP_MESS:"请在此输入留言内容，我们会尽快与您联系。",ERR_NOT_NULL:"不能为空",ERR_NOT_SELECTED:"未选择有效的值",ERR_TEXT_TOO_LONG:"不能超过500个字符",ERR_ITEM_TOO_LONG:"不能超过100个字符",ERR_TITLE:"对不起，您提交的留言存在以下错误：",ERR_NUMBER_ONLY:"应当全部由数字组成",ERR_EMAIL_STYLE:"不是标准邮箱格式",SUCCESS:"留言成功！谢谢您，我们会尽快与您联系！",FAILED:"对不起！您的网络存在异常，为了确保留言发送成功请稍后再试一次！"},t={TITLE:"Send message to us",TEXT:"Contents",SEND:"Send",RIGHT_TIP:"Powered by Baidu",NAME:"Name",PHONE:"Tel%bd_bp_sp%Leave us your telephone number",ADDRESS:"Address",EMAIL:"Email%bd_bp_sp%Leave us your email",SELECT:"Please Select ",TIP_DEFAULT:"Less than 100 chars",TIP_MESS:"Leave us your message，we will contact you as soon as possible！",ERR_NOT_NULL:" is necessary",ERR_NOT_SELECTED:" is not correctly selected",ERR_TEXT_TOO_LONG:" should be less than 500 chars",ERR_ITEM_TOO_LONG:" should be less than 100 chars",ERR_TITLE:"Sorry, some errors exist in your submition:",ERR_NUMBER_ONLY:" should be numbers",ERR_EMAIL_STYLE:" is illegal",SUCCESS:"Thank You! We have received your message and will respond promptly",FAILED:"Opps！The Operation Failed Due to Network or Other Communication Problems"};return{CHINESE:e,ENGLISH:t}}),qiao.define("front/mess/view",function(require){"use strict";function e(){o.on("mess:min",w.min),o.on("mess:max",w.max),o.on("mess:show",w.show),o.on("mess:hide",w.min),o.on("mess:center",w.center),o.on("mess:toggle",w.toggle)}function t(e){var t=s.g(S);return t?t.innerHTML="":(t=document.createElement("ins"),t.id=S,t.className=E,t.style.visibility="hidden",t.style.display="none",e.appendChild(t)),t}function n(){x.status="show",y.messWrap.style.display="block",b.setWrapTop(y.messWrap)}function i(){y.messWrap.style.display="none",x.status="hide"}var r,a=require("../base/browser"),o=require("../base/emitter"),s=require("../base/dom"),u=require("../base/lang"),l=require("../common/Mask"),c=require("../common/Fixed"),d=require("./view/language"),f=require("./view/common"),p=require("./view/container"),h=require("./view/body"),m=require("./view/head"),g=require("./view/foot"),v=null,b=require("../common/view"),y={messWrap:null,container:null,body:null,head:null,foot:null},x={status:"hide"},w={},C=f.className("wrap-min"),T=f.className("wrap-center"),S=f.id("wrap"),E=f.className("wrap");return w.max=function(){s.removeClass(y.messWrap,C),r&&r.auto(),v&&v.resizeFix()},w.show=function(){"hide"==x.status&&n(),s.removeClass(y.messWrap,C)},w.min=function(){s.removeClass(y.messWrap,T),s.addClass(y.messWrap,C),6==a.ie&&(y.messWrap.style.cssText=""),r&&r.auto(),v&&v.resizeFix()},w.toggle=function(){var e=y.messWrap.className;-1!=e.indexOf(C)?o.emit("mess:max"):o.emit("mess:min")},w.center=function(){n(),s.removeClass(y.messWrap,C),s.addClass(y.messWrap,T),6==a.ie&&(y.messWrap.style.cssText=""),r&&r.auto(),v&&v.resizeFix(),o.emit("stat","CLICK_MESS",{})},{render:function(n,i){i=u.extend({},i),i.LANGUAGE||(i.LANGUAGE=0==i.messItem.language?d.CHINESE:d.ENGLISH);var a={};y.messWrap=t(n),y.container=p.render(y.messWrap,i),a.head=m.render(y.container,i),a.body=h.render(y.container,i),a.foot=g.render(y.container,i),r=new l(y.messWrap),v=new c(y.messWrap),e();var o=y.messWrap;return a.container=y.container,a.messWrap=y.messWrap,u.extend(o,{elements:a})},show:n,hide:i}}),qiao.define("front/mess/main",function(require){function e(e){e=e||{},u=require("../base/lang").extend(u,e),u.siteId=require("../data/config").getSiteId(),u.pageId=require("../data/config").getPageId()}function t(){o.hasLoginSub()||i.show()}function n(){var n=a.getStyleConfig("mess"),l=r.getWrap();e(n),u.LANGUAGE=0==u.messItem.language?s.CHINESE:s.ENGLISH;var c=i.render(l,u);if(0==u.messType.disableMess)if(1==u.messShow.messFloatType)i.show();else{var d=o.asyncHandle();d.then(t)}return c}var i=require("./view"),r=require("../common/view"),a=require("../data/config"),o=require("../data/group");require("../base/emitter");var s=require("./view/language"),u={messItem:{messItemName:0,messItemPhone:0,messItemAddress:0,messItemEmail:0,messItemText:1,language:0},extraMessItems:[],messType:{disableMess:0},messShow:{messFloatType:1},messPosition:{position:3},messSkin:{active:0,backgroundColor:"#3399CC",backgroundUrl:"http://qiao.baidu.com/v3/res/messbg/04.png"}};return{init:n}}),qiao.require(["front/data/config","front/mess/main"],function(e,t){t.init(e.getStyleConfig("mess"))}),qiao.define("front/net/jsonp",function(){"use strict";function e(e,i){var s=a(),p=null,h=i.timeout||null,m=i.callbackKey||d,g=s,v=i.data||{};v.t=(new Date).getTime();var b=i.charset||f,y=function(e){i.onsuccess&&i.onsuccess(e),n(p),r(g)},x=function(){i.onfail&&i.onfail(),n(p),r(g)},w=o({url:e+t(e,v,m,g),charset:b,id:s});l[s]=u[s]=function(){y.apply(null,arguments)},c[s]=function(){x.apply(null,arguments)},h&&(p=setTimeout(function(){p=null,w.abort(),x.call(null)},h)),w.send()}function t(e,t,n,i){var r={}.toString.call(t),a="?";e.indexOf("?")>-1&&(a="&");var o=a+n+"="+i;if("[object Object]"===r)for(var s in t)t.hasOwnProperty(s)&&(o+="&"+s+"="+encodeURIComponent(t[s]));return o}function n(e){e&&(clearTimeout(e),e=null)}function i(e){u[e]&&(u[e]=p(e),l[e]=null,delete l[e])}function r(e){try{l[e]=null,u[e]=null,delete l[e],delete u[e]}catch(t){}}function a(){var e="cxxxxxxx_xxxx_4xxx_yxxx_xxxxxxxxxxxx";return e.replace(/[xy]/g,function(e){var t=0|16*Math.random(),n="x"==e?t:8|3&t;return n.toString(16)})}function o(e){var t,n=s.head||s.getElementsByTagName("head")&&s.getElementsByTagName("head")[0]||s.body;return{send:function(){t=s.createElement("script"),t.async=!0,t.charset=e.charset,t.src=e.url,t.id=e.id,t.onload=t.onreadystatechange=function(n){(n===!0||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n===!0&&i(e.id))},t.onerror=function(){t.parentNode&&t.parentNode.removeChild(t),c[t.id]&&c[t.id].call(null),t=null},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(!0)}}}var s=document,u=window,l={},c={},d="callback",f="utf-8",p=function(e){return function(){try{u[e]=null,delete u[e]}catch(t){}}};return{request:e}}),qiao.define("front/common/qiao",function(){var e=function(){var t=this,n=function(e,t){return e&&e.hasOwnProperty&&e instanceof t};return n(t,e)?t._init():t=new e,t};return function(){function t(e){return function(){throw new Error("need to implement "+e)}}function n(e,t,exports){exports.fire=exports.fire||function(){var n=[].slice.call(arguments);n.unshift(t),e.fire.apply(e,n)},exports.on=exports.on||function(n,i){e.on(t,n,i)}}var i,r=[].slice,a={}.toString,o=".",s={mods:{},_attached:{},_loaded:{},_events:{}};i={_init:function(){var e=this,t="Qiao_"+(+new Date).toString(16),n=s._attached,i=s._events;e.id=t,n[t]={},i[t]={}},define:function(e,t,n){var i={name:e};n||(n=t,t=[]),t=t||[],i.fn=n,i.requires=t,s.mods[e]=i},use:function(){var e,t,n=r.call(arguments,0),i=n[n.length-1],o=(s.mods,this),u=[];for("[object Function]"===a.call(i)?n.pop():i=null,"[object Array]"===a.call(n[0])&&(n=n[0]),e=0,t=n.length;t>e;e++)u.push(n[e]);o._attach(u)&&i(o)},_attach:function(e){var i,r,o,u,l,c,exports,d=this,f=s.mods,p=s._attached,h=p[d.id],m=e.length;for(l=0;m>l;l++)if(i=e[l],!h[i]&&(exports=d._namespace(i),r=f[i])){if(h[i]=!0,o=r&&r.requires)for(c=0;u=o[c];c++)if(!h[u]){if(!d._attach(o))return!1;break}if(r.fn&&(n(d,i,exports),r.fn(d,exports),exports.interfaces&&"[object Array]"==a.call(exports.interfaces)))for(c=0;u=exports.interfaces[c];c++)exports[u]=t(u)}return!0},_namespace:function(){var e,t,n,i,r,a=arguments,s=0;for(t=a.length;t>s;s++)if(e=this,r=a[s],r.indexOf(o)>-1)for(i=r.split(o),n="qiao"==i[0].toLowerCase()?1:0;n<i.length;n++)e[i[n]]=e[i[n]]||{},e=e[i[n]];else e[r]=e[r]||{},e=e[r];return e},implement:function(e,t){var n,i,r=e.interfaces||[];for(n=0;i=r[n];n++)t[i]&&(e[i]=t[i])},fire:function(module,e){var t,n,i=this,r=[].slice.call(arguments),a=s._events[i.id];for(a=a[module]||{},a=a[e]||[],r.splice(0,2),t=0;n=a[t];t++)n.apply(null,r)},on:function(module,e,t){var n=this,i=s._events[n.id];i=i[module]?i[module]:i[module]={},i=i[e]?i[e]:i[e]=[],i.push(t)}},e.prototype=i,e.define=i.define,e.cb={}}(),window.Qiao=e,e}),qiao.define("front/storage/flash",function(require,exports){function e(){this.version="1-0-0",this.so=null,this.promise=new o}function t(){var e=a.getIdPre("flash"),t=a.getClassPre("flash"),n=e+"storage",r=t+"storage";return i.g(n)?i.g(n):i.create("ins",{id:n,className:r,styles:{position:"fixed",bottom:0}})}var n=require("../base/string"),i=require("../base/dom"),r=require("../data/config"),a=require("../common/view"),o=require("../base/Promise"),s={},u=null;s.version=function(){var e=navigator;if(e.plugins&&e.mimeTypes.length){var t=e.plugins["Shockwave Flash"];if(t&&t.description)return t.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s)+r/,".")+".0"}else if(window.ActiveXObject&&!window.opera)for(var n=12;n>=2;n--)try{var i=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+n);if(i){var r=i.GetVariable("$version");return r.replace(/WIN/g,"").replace(/,/g,".")}}catch(a){}}(),s.createHTML=function(e){var t,i,r,a,o,u,l=s.version,c=e.ver||"6.0.0",d={},f=n.encodeHTML;for(a in e)d[a]=e[a];if(e=d,!l)return"";for(l=l.split("."),c=c.split("."),r=0;3>r&&(t=parseInt(l[r],10),i=parseInt(c[r],10),!(t>i));r++)if(i>t)return"";var p=e.vars,h=["classid","codebase","id","width","height","align"];if(e.align=e.align||"middle",e.classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000",e.codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,0,0",e.movie=e.url||"",delete e.vars,delete e.url,"string"==typeof p)e.flashvars=p;else{var m=[];for(a in p)u=p[a],m.push(a+"="+encodeURIComponent(u));e.flashvars=m.join("&")}var g=["<object "];for(r=0,o=h.length;o>r;r++)u=h[r],g.push(" "+u+'="'+f(e[u])+'"');g.push(">");var v={wmode:1,scale:1,quality:1,play:1,loop:1,menu:1,salign:1,bgcolor:1,base:1,allowscriptaccess:1,allownetworking:1,allowfullscreen:1,seamlesstabbing:1,devicefont:1,swliveconnect:1,flashvars:1,movie:1};for(a in e)e.hasOwnProperty(a)&&(u=e[a],a=a.toLowerCase(),v[a]&&(u||u===!1||0===u)&&g.push('<param name="'+a+'" value="'+f(u)+'" />'));e.src=e.movie,e.name=e.id,delete e.id,delete e.movie,delete e.classid,delete e.codebase,e.type="application/x-shockwave-flash",e.pluginspage="http://www.macromedia.com/go/getflashplayer",g.push("<embed");var b;for(a in e)if(e.hasOwnProperty(a)&&(u=e[a],u||u===!1||0===u)){if(new RegExp("^salign$","i").test(a)){b=u;continue}g.push(" "+a+'="'+f(u)+'"')}return b&&g.push(' salign="'+f(b)+'"'),g.push("></embed></object>"),g.join("")},s.create=function(e,t){e=e||{};var n=s.createHTML(e)||e.errorMessage||"";t&&"string"==typeof t&&(t=document.getElementById(t)),i.insertHTML(t||document.body,"beforeEnd",n)},SWFObject_baidu=function(e,t){this.cid=t,this.swfId=e.id,this.options=e,this.asObjects={},this.onLoadInit=function(){},SWFObject_baidu.instances[this.swfId]=this},SWFObject_baidu.prototype={load:function(){s.create(this.options,this.cid)},getASObject:function(e){return this.asObjects[e.asoId]},registerASObject:function(e){var t=e.asoId,n=this.swfId;return this.asObjects[t]=new ASObject_baidu({asoId:t,swfId:n})},getASObjectProperty:function(e){return null==this.swf&&(this.swf=document[this.swfId]||window[this.swfId]),this.swf.getASObjectProperty(e)},setASObjectProperty:function(e){null==this.swf&&(this.swf=document[this.swfId]||window[this.swfId]),this.swf.setASObjectProperty(e)},callASObjectMethod:function(e){return null==this.swf&&(this.swf=document[this.swfId]||window[this.swfId]),this.swf.callASObjectMethod(e)}},SWFObject_baidu.instances={},SWFObject_baidu.getSWFObject=function(e){return SWFObject_baidu.instances[e.swfId]},SWFObject_baidu.dispatchASObjectEvent=function(e){var t=e.swfId,n=e.asoId,i=e.type,r=e.data,a=SWFObject_baidu.getSWFObject({swfId:t}),o=void 0==n?a:a.getASObject({asoId:n}),s="on"+i.substr(0,1).toUpperCase()+i.substr(1);null!=o[s]&&o[s](r)},SWFObject_baidu.registerASObject=function(e){e.swfId,e.asoId;var t=SWFObject_baidu.getSWFObject(e);t.registerASObject(e)},ASObject_baidu=function(e){this.swfId=e.swfId,this.asoId=e.asoId,this.swfObject=SWFObject_baidu.getSWFObject(e),null==ASObject_baidu.instances[this.swfId]&&(ASObject_baidu.instances[this.swfId]={}),ASObject_baidu.instances[this.swfId][this.asoId]=this},ASObject_baidu.prototype={get:function(e){return this.swfObject.getASObjectProperty({asoId:this.asoId,property:e})},set:function(e,t){this.swfObject.setASObjectProperty({asoId:this.asoId,property:e,value:t})},call:function(e,t){return this.swfObject.callASObjectMethod({asoId:this.asoId,method:e,parameters:t})}},ASObject_baidu.instances={},e.prototype={onLoadInit:function(){var e=this;e.promise.done()},load:function(e,t){var n=this;n.so=new SWFObject_baidu(e,t);var i=n.so;i.onLoadInit=function(){n.ao=i.asObjects.localStorage,n.onLoadInit&&n.onLoadInit()},i.load()},read:function(e,t){try{return this.ao.call("read",[e,t])}catch(n){return null}},write:function(e,t,n){try{return this.ao.call("write",[e,t,n])}catch(i){return!1}},remove:function(e,t){try{return this.ao.call("remove",[e,t])}catch(n){return!1}},clear:function(e){try{return this.ao.call("clear",[e])}catch(t){return!1}},create:function(){var e=t();a.getWrap().appendChild(e);var n=a.getIdPre("flash"),i=n+"storage",o=this,s=r.getRoot();o.load({id:"FlashLocalStorage",width:5,height:5,url:s+"/swf/local_storage.swf",wmode:"transparent",allowscriptaccess:"always"},i)}},exports.getLs=function(){return u},exports.init=function(){return u||(u=new e,u.create()),u.promise.promise()}}),qiao.define("front/storage/localStorage",function(require,exports){"use strict";function e(e){n.localStorage?u.ls=n.localStorage:(u.ls=s,u.ls.build(e))}var t=require("../base/browser"),n=window,i=n.document,r="",a="",o="_QIAO_USERDATA_",s=function(){function e(e){return e.replace(s,"___")}var t,n=null,a=365,s=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");return{build:function(e){e=e||{},t=o+(e.siteId||r),a=e.expires||a},setup:function(){if(!n)try{n=i.createElement("input"),n.type="hidden",n.addBehavior("#default#userData"),i.body.appendChild(n)}catch(e){return!1}return!0},setItem:function(i,r){i=e(i);var o=this,s=new Date;return o.setup()?(s.setDate(s.getDate()+a),n.expires=s.toUTCString(),n.load(t),n.setAttribute(i,r),n.save(t),r):void 0},getItem:function(i){i=e(i);var r=this;if(r.setup())return n.load(t),n.getAttribute(i)},removeItem:function(i){i=e(i);var r=this;r.setup()&&(n.load(t),n.removeAttribute(i),n.save(t))},clear:function(){var e=new Date;e.setDate(e.getDate()-1),n.expires=e.toUTCString()}}}(),u={INTERVAL:1e3,ls:null,useTimer:t.ie&&t.ie<8,timer:null,keyEvent:{}},l={onStorage:function(e,t,i){var r=u.ls.getItem(e);return i=i||null,function(a){setTimeout(function(){a=a||n.storageEvent;var o=a.key,s=a.newValue;if(!o){var l=u.ls.getItem(e);l!=r&&(o=e,s=l)}o==e&&(t&&t.call(i,a.oldValue||r,s),r=s)},0)}}};return exports.setItem=function(e,t){return e=a+e,u.ls.setItem(e,t)},exports.getItem=function(e){return e=a+e,u.ls.getItem(e)},exports.removeItem=function(e){return e=a+e,u.ls.removeItem(e)},exports.clear=function(){u.ls.clear()},exports.addStorageEvent=function(e,r){e=a+e;var o;u.useTimer?(o=l.onStorage(e,r),u.timer=setInterval(function(){o({})},u.INTERVAL)):(o=l.onStorage(e,r),i.attachEvent&&!t.opera?i.attachEvent("onstorage",o):n.addEventListener("storage",o,!1))},e({}),exports}),qiao.define("front/webim/lite",function(require,exports){function e(e){var t;if(4==e.status){t=p.getGroupBySub(e.subid)||{};var n={type:0,chattype:w.chatType.enforce,tid:t.groupid,subid:e.subid,groupname:t.groupname};i(n)}}function t(){var e=g.getLs(),t=e.read(S,E.prevInfo)||"{}";return y.parse(t)}function n(e){var n=t(),i=g.getLs();d.extend(n,e),i.write(S,E.prevInfo,y.stringify(n))}function i(e){var t=g.getLs(),n=t.read(S,E.instance),i=T.DIS,o=e.type,s=e.tid,u=e.subid,l=e.groupname,c=e.from,d=e.lastsubid,f=e.siteid,p=(new Date).getTime();if(!(1e3>p-n)&&C)if(""===s){o=3,w.vis_type=o,w.vis_subid=u,w.vis_from=c,w.lastsubid=d,w.chattype=e.chattype;var h="&siteid="+f+"&groupid="+s+"&groupname="+l+"&from="+c+"&lastsubid="+d;x.request(i+h,{onsuccess:a})}else r({type:o,chattype:e.chattype,bridgeTid:s+"",subid:u||"",userGroupName:l})}function r(e){var t=g.getLs();C.accept({type:e.type,chattype:e.chattype,bridgeTid:e.bridgeTid||e.tid,subid:e.subid||"",userGroupName:e.groupname})&&setInterval(function(){t.write(S,E.instance,(new Date).getTime())},500)}function a(e){if(0==e.status){var t=e.groupid,n=e.groupname;r({type:w.vis_type,chattype:w.chattype,bridgeTid:t,subid:w.vis_subid||"",userGroupName:n})}}function o(e){f.setStyleConfig("webim",{webimtype:e})}function s(e){C=e.business.webimlite;var i=f.getStyleConfig("webim"),r=g.getLs();C.on("revertsession",function(){o(1),setInterval(function(){r.write(S,E.instance,(new Date).getTime())},500)}),C.on("unload",function(){}),C.on("ready",function(){var e=t();e.lc=e.lc?parseInt(e.lc,10):0,n({lc:e.lc+1}),o(1)}),C.on("changesubid",function(e){n({ls:e})});var a=i.webimposition;a=3===a?1:0;var s="undefined"!=typeof i.webimchat.showtype?i.webimchat.showtype:-1;C.init({bid:f.getModelData("bid"),siteid:f.getSiteId(),mainid:f.getMainId()||0,SITE_ID:f.getSiteIdMd5()||0,userName:f.getUserName(),offsetTime:0,root:f.getRoot(),bgColor:i.webimlitebgcolor||"",position:a||0,csNameType:s,customName:i.webimchat.name||"",searchInfo:w.searchInfo})}function u(){var e=f.getRoot();b.css(e+"asset/css/m-webim-lite.css?v=20130705"),b.js(e+"asset/js/m-webim-lite.js?v=20140719",{},function(){I=1,l()})}function l(){I&&N&&v().use(["business.webimlite"],s)}function c(){var e,t,n=["referrer","location","title","word","wordtype","wordid","from"],i=d.extend({},f.getModelData());for(w.searchInfo={},e=0;t=n[e];e++)w.searchInfo[t]=i[t]||"";N=1,l()}require("../base/dom");var d=require("../base/lang");require("../common/view");var f=require("../data/config"),p=require("../data/group"),h=require("../base/emitter"),m=require("../common/identity");require("../storage/localStorage");var g=require("../storage/flash"),v=require("../common/qiao"),b=require("../base/loader"),y=require("../base/json"),x=require("../net/jsonp"),w={chatType:{byInvite:0,bySelf:1,enforce:5}},C=null,T={DIS:f.getRoot()+"?module=default&controller=webim&action=visdistribute"},S=m.getFlashId(),E={data:m.getFlashKey("data"),last:m.getFlashKey("last"),show:m.getFlashKey("show"),instance:m.getFlashKey("instance"),chat:m.getFlashKey("chat"),startload:m.getFlashKey("startload"),prevInfo:m.getFlashKey("prevInfo"),offsetTime:m.getFlashKey("offsetTime"),firstInfo:m.getFlashKey("firstInfo")},I=0,N=0;exports.init=function(){u(),g.init();var t=p.asyncHandle();t.then(c),h.on("rcv:refresh",function(t){e(t)})},exports.chat=i,exports.show=function(){C.show()}}),qiao.define("front/base/json",function(){function e(e){var t={}.toString.call(e);return t=t.substring(8,t.length-1),t.toLowerCase()}function t(t){var i=n[e(t)];return i?i(t):""+t}var n={};return n.array=function(e){var n=[];n.push("[");for(var i=0,r=e.length;r>i;i++)n.push(t(e[i])),n.push(",");return n.splice(n.length-1,1),n.push("]"),n.join("")},n.object=function(e){if(null===e)return"null";var n=[];n.push("{");for(var i in e)e.hasOwnProperty(i)&&(n.push('"'+i+'":'),n.push(t(e[i])),n.push(","));return n.splice(n.length-1,1),n.push("}"),n.join("")},n.string=function(e){return'"'+e+'"'},{parse:function(e){var t=null;try{t=window.JSON&&window.JSON.parse?window.JSON.parse(e):new Function("return ("+e+");")()}catch(n){}return t},stringify:function(e){var n;return n=window.JSON&&window.JSON.stringify?window.JSON.stringify(e):t(e)}}}),qiao.define("front/base/loader",function(){function e(e,a,o,s){var u,l,c,d=this,f=t.getElementsByTagName("head")[0];for(d.callback=s||function(){},d.queue=[],a="string"==typeof a?[a]:a,l=0,c=a.length;c>l;l++)this.queue[l]=1,"css"==e?n.isGecko?(u=r.createNode("style"),u.innerHTML='@import "'+a[l]+'";'):u=r.createNode("link",r.merge({type:"text/css",rel:"stylesheet",href:a[l]},o)):u=r.createNode("script",r.merge({type:"text/javascript",src:a[l],charset:"utf-8"},o)),i?"css"==e&&2==i?function(){var e=0,t=setInterval(function(){try{u.sheet.cssRules,clearInterval(t),d._callback()}catch(n){e+=1,e>100&&(clearInterval(t),d._callback())}},100)}():u.onload=function(){d._callback()}:u.onreadystatechange=function(){/^loaded|complete$/.test(this.readyState)&&(this.onreadystatechange=null,d._callback())};f.appendChild(u)}var t=document,n=function(){var e=navigator.userAgent;return{async:t.createElement("script").async===!0,firefox:/firefox\/(\d+\.\d+)/i.test(e)?+RegExp.$1:void 0,ie:/msie (\d+\.\d+)/i.test(e)?document.documentMode||+RegExp.$1:void 0,isStrict:"CSS1Compat"==document.compatMode,isGecko:/gecko/i.test(e)&&!/like gecko/i.test(e),isWebkit:/webkit/i.test(e),opera:/opera(\/| )(\d+(\.\d+)?)(.+?(version\/(\d+(\.\d+)?)))?/i.test(e)?+(RegExp.$6||RegExp.$2):void 0}}(),i=n.ie?0:n.opera?1:2,r={createNode:function(e,n){var i,r=t.createElement(e);for(i in n)n.hasOwnProperty(i)&&r.setAttribute(i,n[i]);return r},load:function(t,n,i,r){"function"==typeof i&&(r=i,i={}),new e(t,n,i,r)},merge:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}};return e.prototype={_callback:function(){var e=this;e.queue.pop()&&0==e.queue&&e.callback()}},{css:function(e,t,n){return r.load("css",e,t,n)},js:function(e,t,n){return r.load("js",e,t,n)}}}),qiao.define("front/webim/main",function(require){function e(){var e=s.getRoot(),t="http://webim.qiao.baidu.com/im/gateway";return e.indexOf("h.qiao.baidu.com")>-1&&(t="http://webim.h.qiao.baidu.com/im/gateway"),t}function t(t,n){var i=e()+"?siteid="+t.siteid+"&siteidstr="+t.siteidstr+"&mainid="+t.mainid+"&csNameType=2"+"&csName="+encodeURIComponent("在线客服")+"&userName="+encodeURIComponent(t.userName)+"&groupName="+encodeURIComponent(t.groupname)+"&groupid="+t.groupid+"&sub="+t.subid+"&distributeType="+t.type+"&bid="+n;window.open(i,"BridgeImWindow")}function n(e){var t,n,i,r=[];for(t in e)if(e.hasOwnProperty(t))if(n=e[t],h.isArray(n))for(i=n.length;i--;)r.push(t+"="+encodeURIComponent(n[i]));else r.push(t+"="+encodeURIComponent(n));return r.join("&")}function i(){return m.hasLoginSub()}function r(e){if(e=e||{},!i())return o.emit("mess:center"),void 0;var r=e.groupid,a=e.groupname,y=e.chat,x=e.subid,w=e.subname,C=s.getSiteId(),T=f.getItem(u.getLSKey("bid")),S=g.webimtype,E=p.getLs(),I=h.extend({},s.getModelData());e.chat&&E.write(v,b.chat,y);var N=E.read(v,b.instance),j=(new Date).getTime();if(null==N||j-N>=1e3){if(void 0!==r){var M=m.getGroupNameById(r);e.groupname=M,a=M}if(void 0!=x){var k=m.getGroupBySub(x);e.subname=k.subname,e.groupid=k.groupid,e.groupname=k.groupname,r=k.groupid,w=k.subname,a=k.groupname}void 0===r&&(e.groupid="",e.groupname="",r=""),I.tid=r,""!==x&&void 0!==x?(I.type=0,I.subid=x,I.subname=w):(I.type=1,I.subid="",I.subname="",e.subid="",e.subname=""),e.groupid=""+e.groupid,e.subid=""+e.subid,E.write(v,b.startload,(+new Date).toString()),E.write(v,b.data,I);var _=E.read(v,b.prevInfo)||"{}";_=l.parse(_);var A=_.ls||"";if(d.isMobile){var B=I.type;1!=B||""!=r&&void 0!=r||(B=3),t({type:B,siteid:C,siteidstr:s.getSiteIdMd5(),mainid:s.getMainId(),userName:s.getUserName(),groupname:e.groupname,groupid:e.groupid,subid:e.subid},T)}else if(S){var O={type:I.type,chattype:e.chattype,tid:e.groupid,subid:e.subid,groupname:e.groupname,from:s.getModelData("from"),lastsubid:A,siteid:C};c.chat(O)}else{e.ref=window.location.href;var D="siteid="+C+"&lastsubid="+A+"&from="+encodeURIComponent(s.getModelData("from"))+"&bid="+T+"&"+n(e),P=(window.screen.availWidth-796)/2,L=(window.screen.availHeight-562)/2,R="left="+P+",top="+L+",resizable=yes,width=795,height=561",H=window.open(s.getRoot()+"?module=default&controller=webim&action=index&"+D,"BrIdgeIMWinDow",R);H?H.focus():o.emit("stat","BLOCK_POP",{})}}else S?c.show():E.write(v,b.show,1),o.emit("stat","ALREADY_OPEN",{})}function a(){o.on("webim:open",r)}var o=require("../base/emitter"),s=require("../data/config"),u=require("../common/identity");require("../base/loader");var l=require("../base/json"),c=require("./lite"),d=require("../base/browser"),f=require("../storage/localStorage"),p=require("../storage/flash"),h=require("../base/lang"),m=require("../data/group"),g=s.getStyleConfig("webim"),v=u.getFlashId(),b={data:u.getFlashKey("data"),last:u.getFlashKey("last"),show:u.getFlashKey("show"),instance:u.getFlashKey("instance"),chat:u.getFlashKey("chat"),startload:u.getFlashKey("startload"),prevInfo:u.getFlashKey("prevInfo"),offsetTime:u.getFlashKey("offsetTime"),firstInfo:u.getFlashKey("firstInfo")};return{init:function(){c.init(),p.init(),a()}}}),qiao.define("front/net/img",function(){"use strict";function e(e,n){e+=t(e,n.data);var i=new Image;i.onload=function(){i.onload=null,i.onerror=null,i=null,n.onsuccess&&n.onsuccess()},i.onerror=function(){i.onload=null,i.onerror=null,i=null,n.onfail&&n.onfail()},i.src=e}function t(e,t){var i={}.toString.call(t),r="?";if(e.indexOf("?")>-1&&(r="&"),"[object Object]"===i){for(var a in t)t.hasOwnProperty(a)&&(r+=a+"="+encodeURIComponent(t[a])+"&");r+="t="+n()}return r}var n=function(){var e=0;return function(){var t=(new Date).getTime();return t+="_"+e++}}();return{request:e}}),qiao.define("front/common/log",function(require){function e(e,t){if(e&&o[e]){var s=a+"?siteid="+n.getSiteId()+"&type="+o[e];r.request(s,{data:i.extend({},t)})}}var t=require("../base/emitter"),n=require("../data/config");require("../base/json");var i=require("../base/lang"),r=require("../net/img"),a=n.getRoot()+"statlog/stat.gif",o={SEND_INVITE:"invite",CLICK_ICON:"clickIcon",CLOSE_INVITE:"inviteclose",CLICK_MESS:"clickIconMess",BLOCK_POP:"blockpop",ALREADY_OPEN:"alreadyopen",OPEN_WEBIMLITE:"openwebimlite",LOAD_TIME:"loadtime"};return{init:function(){t.on("stat",e)}}}),qiao.define("front/common/stat",function(require){function e(){return Math.floor(1e10*Math.random())}function t(e){var t=new Image,n=p+"?"+e;t.onload=t.onerror=function(){t=null},t.src=n}function n(e,t){for(var n in e)e.hasOwnProperty(n)&&t[n]&&(e[n]=t[n])}function i(n){var i="si="+d.siteId+"&et=99&ep="+d.mainId;i+=r(n),i=i+m+e(),t(i)}function r(e){var t,n,i="",r=v.length;for(t=0;r>t;t++)n=v[t],i+=""===e[n]?"*"+h:"*"+e[n];return i}function a(e){b.visitor_count&&(n(f,e),f.eventId=g.VISITOR_IM,f.count=b.visitor_count,f.valid=1,i(f),b.visitor_count=0,f.valid=0)}function o(e){e.chatId?(n(f,e),f.eventId=g.VISITOR_IM,f.valid=1,i(f),b.visitor_count=0,f.valid=0):b.visitor_count+=e.count}function s(e,t){if(e&&g[e])switch(d.siteId=d.siteId||l.getSiteIdMd5()||0,d.mainId=d.mainId||l.getMainId()||0,e=e.toUpperCase()){case"VISITOR_IM":o(t);break;case"START_IM":a(t);break;default:n(f,t),f.eventId=g[e],i(f)}}var u=require("../base/emitter"),l=require("../data/config"),c=require("./log"),d={siteId:"",mainId:""},f={mainId:"",subId:"",sessionId:"",eventId:"",chatId:"",from:"",open:"",valid:"",count:""},p="http://hm.baidu.com/hm.gif",h=0,m="&nv=0&st=4&v=bridge-0.2&rnd=",g={REFRESH_IM:1,SEND_INVITE:3,ACCEPT_INVITE:4,SEND_MESS:5,VISITOR_IM:6,SERVER_IM:7,START_IM:0},v=["subId","sessionId","eventId","chatId","from","open","valid","count"],b={visitor_count:0};return window.BDBridgeStat=function(e,t,n){s(e,n)},function(){u.on("stat",s),c.init()}}),qiao.define("front/rcv/info",function(require){function e(){var e=r.getLs(),t=o.parse(e.read(l,a.getFlashKey("prevInfo"))||"{}"),n=o.parse(e.read(l,a.getFlashKey("firstInfo"))||"{}");return{lc:t.lc||0,fs:n.fs||"",ls:t.ls||""}}function t(){var t={siteid:i.getSiteId(),bid:i.getModelData("bid")},r=e();t=s.extend(t,r),n.request(u,{data:t})}var n=require("../net/jsonp"),i=require("../data/config"),r=require("../storage/flash");require("../base/emitter");var a=require("../common/identity"),o=require("../base/json"),s=require("../base/lang"),u=i.getRcvRoot()+"Info.php",l=a.getFlashId();return function(){r.init().then(function(){t()})}}),qiao.define("front/rcv/leave",function(require){function e(e){u.bid=e.bid||u.bid,u.siteid=e.siteid||u.siteid;var t={data:{bid:u.bid,siteid:u.siteid}};r.request(s.LEAVE,t),i.emit("rcv:leave",t.data)}function t(t){u.bid=t.bid||"",u.siteid=t.siteid||"",n.on(window,"unload",e,!1),n.on(window,"beforeunload",e,!1)}var n=require("../base/event"),i=require("../base/emitter"),r=require("../net/img"),a=require("../data/config"),o=a.getRcvRoot(),s={LEAVE:o+"Leave.php"},u={state:0};return{init:t,leave:e}}),qiao.define("front/rcv/refresh",function(require){function e(e){h=f,m.callback?m.callback(e):0===e.saved&&g.stop(),r.emit("rcv:refresh",e),setTimeout(function(){n()},m.refreshTime)}function t(){h=f,setTimeout(function(){n()},m.refreshTime)}function n(){if(d){h=p;var n={data:{bid:m.bid||"",siteid:m.siteid||""},timeout:m.timeout,onsuccess:e,onfail:t};i.request(s.REFRESH,n)}}var i=require("../net/jsonp"),r=require("../base/emitter"),a=require("../data/config"),o=a.getRcvRoot(),s={REFRESH:o+"Refresh.php",REJECT:o+"Reject.php"},u=5e3,l=15e3,c=function(){},d=!0,f=1,p=2,h=1,m={siteId:"",bid:"",refreshTime:u,timeout:l,callback:c,timer:null},g={};return g.start=function(e){m.siteid=e.siteid,m.bid=e.bid||"",m.refreshHandler=e.callback||c,m.refreshTime=e.refreshTime||u,d=!0,n()
},g.stop=function(){d=!1},g.revert=function(){h!=f?setTimeout(function(){g.revert()},500):(d=!0,n())},g}),qiao.define("front/rcv/entered",function(require){function e(e,t){var n=f.getLSKey(e),i=t||"";g.setItem(n,i)}function t(t){b.bid=t.bid;var n={bid:t.bid,siteid:p.getSiteId(),from:t.from,word:t.word,wordid:t.wordid,wordtype:t.wordtype,referrer:t.referrer,title:t.title,location:t.location};t.zhixin&&(n.zhixin=t.zhixin);var i=t.service_type;i&&i>0&&(n.servertype=t.service_type),p.setModelData(n),e("bid",t.bid),e("info",u.stringify({lv:t.lv||0,lvp:t.lvp||0,ft:t.ftime||0,lt:t.ltime||0})),m.init().then(function(){var e=m.getLs();e.write(c.getFlashId(),c.getFlashKey("bid"),t.bid)})}function n(){var e={bid:b.bid,siteid:p.getSiteId()};l.request(y.REJECT,{data:e})}function i(){a.on("rcv:reject",n)}function r(e,n){if(0==b.state){b.state=1;var r={siteid:e.siteid||"",bid:e.bid||n.bid},u={siteid:e.siteid||"",bid:e.bid||""};h(),t(n),i(),o.start(r),s.init(u),d.handleGroup(n),a.emit("rcv:enter",n);var l=p.getStartTime()||(new Date).getTime(),c=(new Date).getTime(),f=c-l;a.emit("stat","LOAD_TIME",{cost:f})}}var a=require("../base/emitter"),o=require("./refresh"),s=require("./leave"),u=require("../base/json"),l=require("../net/img"),c=require("../common/identity"),d=require("../data/group"),f=require("../common/identity"),p=require("../data/config"),h=require("./info"),m=require("../storage/flash"),g=require("../storage/localStorage"),v=p.getRcvRoot(),b={state:0},y={REJECT:v+"Reject.php"};return r}),qiao.require(["front/common/identity","front/data/config","front/common/stat","front/storage/localStorage","front/rcv/entered","front/webim/main"],function(e,t,n,i,r,a){function o(){var t=e.getBSLNs();return t.data||null}function s(t){var n=e.getBSLNs();n.callback=t}function u(e){r({siteid:l,bid:c},e)}n();var l=t.getSiteId(),c=i.getItem(e.getLSKey("bid_")+l);a.init();var d=o();return d?(u(d),void 0):(s(u),void 0)});